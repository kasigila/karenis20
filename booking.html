<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>BYZ Booking</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

<style>
:root{
  --bg:#0b0b12;
  --card:#151520;
  --card2:#1e1e2c;
  --accent:#8A2BE2;
  --accent2:#FF00FF;
  --text:#fff;
  --muted:#a5a5c2;
}

.light{
  --bg:#f4f5f7;
  --card:#ffffff;
  --card2:#f0f0f5;
  --text:#000;
  --muted:#555;
}

*{box-sizing:border-box}

body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:Inter,system-ui;
  transition:.3s;
}

.container{
  max-width:1100px;
  margin:auto;
  padding:40px 20px 120px;
}

h1{text-align:center;font-size:2.4rem}
.subtitle{text-align:center;color:var(--muted);margin-bottom:40px}

/* THEME TOGGLE */
.theme-toggle{
  position:fixed;
  top:20px;
  right:20px;
  background:var(--card);
  border-radius:999px;
  padding:12px 16px;
  cursor:pointer;
  box-shadow:0 10px 40px rgba(0,0,0,.25);
}

/* STEP ANIMATION */
.step{
  opacity:0;
  transform:translateY(40px);
  transition:.6s;
}
.step.active{
  opacity:1;
  transform:none;
}

/* CHOICE */
.choice-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
  gap:24px;
}
.choice{
  background:var(--card);
  border-radius:28px;
  padding:36px;
  text-align:center;
  cursor:pointer;
  border:2px solid transparent;
  transition:.4s;
}
.choice:hover{transform:translateY(-6px)}
.choice.active{
  border-color:var(--accent2);
  box-shadow:0 30px 80px rgba(138,43,226,.45);
}
.choice i{font-size:3.2rem;color:var(--accent2)}

/* DROPDOWN / SELECTOR */
.selector{
  max-width:420px;
  margin:40px auto;
  background:var(--card);
  border-radius:26px;
  padding:30px;
  text-align:center;
}

.selector select{
  width:100%;
  padding:16px;
  border-radius:14px;
  border:none;
  background:var(--card2);
  color:var(--text);
  font-size:1rem;
}

.price-display{
  margin-top:20px;
  font-size:1.6rem;
  font-weight:800;
  color:var(--accent2);
}

/* TABLES */
.packages{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
  gap:24px;
}
.package{
  position:relative;
  background:var(--card);
  border-radius:28px;
  padding:30px;
  border:2px solid transparent;
  transition:.4s;
  cursor:pointer;
}
.package.active{
  border-color:var(--accent2);
  box-shadow:0 30px 80px rgba(255,0,255,.45);
}
.sold{
  pointer-events:none;
  opacity:.35;
}
.sold::after{
  content:"SOLD OUT";
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  background:rgba(0,0,0,.7);
  border-radius:28px;
  font-size:1.4rem;
  font-weight:800;
}

/* PAYMENT */
.payment{
  background:var(--card2);
  border-radius:30px;
  padding:40px;
  text-align:center;
}
.payment img{
  width:220px;
  background:#fff;
  padding:12px;
  border-radius:18px;
}

/* FORM */
.form{
  max-width:520px;
  margin:auto;
}
input{
  width:100%;
  padding:16px;
  border-radius:14px;
  border:none;
  background:var(--card2);
  color:var(--text);
  margin:10px 0;
}
button{
  width:100%;
  padding:18px;
  border:none;
  border-radius:999px;
  background:linear-gradient(135deg,var(--accent),var(--accent2));
  color:#fff;
  font-weight:800;
  cursor:pointer;
}
.notice{text-align:center;color:#ffcc00;font-weight:700;margin-top:16px}
</style>
</head>

<body>

<div class="theme-toggle" onclick="toggleTheme()">
  <i class="fa-solid fa-circle-half-stroke"></i>
</div>

<div class="container">

<h1>Reserve Your Night with BYZ</h1>
<p class="subtitle">Choose your experience</p>

<!-- STEP 1 -->
<div class="step active" id="step1">
  <div class="choice-grid">
    <div class="choice" onclick="selectType('TICKET',this)">
      <i class="fa-solid fa-ticket"></i>
      <h2>Tickets</h2>
      <p class="subtitle">30,000 TZS per ticket</p>
    </div>
    <div class="choice" onclick="selectType('TABLE',this)">
      <i class="fa-solid fa-couch"></i>
      <h2>VIP Tables</h2>
      <p class="subtitle">Premium experience</p>
    </div>
  </div>
</div>

<!-- TICKET SELECTOR -->
<div class="step" id="ticketStep">
  <div class="selector">
    <h2>Select Number of Tickets</h2>
    <select id="ticketQty" onchange="updateTicketPrice()">
      <option value="1">1 Ticket</option>
      <option value="2">2 Tickets</option>
      <option value="3">3 Tickets</option>
      <option value="4">4 Tickets</option>
      <option value="5">5 Tickets</option>
      <option value="6">6 Tickets</option>
      <option value="7">7 Tickets</option>
      <option value="8">8 Tickets</option>
      <option value="9">9 Tickets</option>
      <option value="10">10 Tickets</option>
    </select>
    <div class="price-display" id="ticketTotal">30,000 TZS</div>
  </div>
</div>

<!-- TABLES -->
<div class="step" id="tablesStep">
  <h2 class="subtitle">Choose your VIP package</h2>
  <div class="packages" id="packages"></div>
</div>

<!-- PAYMENT -->
<div class="step" id="paymentStep">
  <div class="payment">
    <h2>Pay via M-Pesa LIPA Number</h2>
    <h1>68286833</h1>
    <div class="payment">
  <h2>Pay via M-Pesa</h2>
  <p class="subtitle">Complete payment before submitting your booking</p>

  <div style="
    background:var(--card);
    border-radius:22px;
    padding:30px;
    margin:30px auto;
    max-width:420px;
  ">
    <p style="color:var(--muted);margin-bottom:6px;">Business Name</p>
    <h3 style="margin-top:0;">BYZ Entertainment</h3>

    <p style="color:var(--muted);margin-bottom:6px;">M-Pesa Lipa Number</p>
    <h1 id="mpesaNumber" style="letter-spacing:2px;">68286833</h1>

    <button
      onclick="copyMpesa()"
      style="
        margin-top:16px;
        padding:14px 22px;
        border-radius:999px;
        border:none;
        background:linear-gradient(135deg,var(--accent),var(--accent2));
        color:white;
        font-weight:700;
        cursor:pointer;
      ">
      ðŸ“‹ Copy Lipa Number
    </button>

    <p style="font-size:.85rem;color:var(--muted);margin-top:14px;">
      <br>
      Once payment is completed copy-paste the Transaction ID into this form
    </p>
  </div>
</div>
    <p class="subtitle">Pay first, then complete booking with Transaction ID</p>
  </div>
</div>
<!-- FORM -->
<div class="step" id="formStep">
  <div class="form">
    <input id="fullName" placeholder="Full Name">
    <input id="phone" placeholder="Phone (WhatsApp)">
    <input id="email" placeholder="Email">
    <input id="txn" placeholder="M-Pesa Transaction Code">
    <button onclick="submitBooking()">Submit Booking</button>
    <div class="notice">WhatsApp will open â€” press SEND to verify payment</div>
  </div>
</div>

</div>

<script>
  function copyMpesa(){
  const number = document.getElementById("mpesaNumber").innerText;

  if (navigator.clipboard) {
    navigator.clipboard.writeText(number);
  } else {
    const temp = document.createElement("textarea");
    temp.value = number;
    document.body.appendChild(temp);
    temp.select();
    document.execCommand("copy");
    document.body.removeChild(temp);
  }

  alert("Lipa number copied. Open M-Pesa to complete payment.");
}
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxl8qg5fxw8yWZJj-R98x0V0nBALjQv66xuJLiom5rkEh_BpYtZRrMcFlYkjxAOq6UC/exec";
const BYZ_WHATSAPP = "255768464367";
const TICKET_PRICE = 30000;

let bookingType="", tier="", ticketQty=1, availability={};

/* THEME */
function toggleTheme(){
  document.body.classList.toggle("light");
}

/* TYPE SELECT */
function selectType(type,el){
  bookingType=type;
  document.querySelectorAll(".choice").forEach(c=>c.classList.remove("active"));
  el.classList.add("active");

  document.getElementById("ticketStep").classList.remove("active");
  document.getElementById("tablesStep").classList.remove("active");

  if(type==="TICKET"){
    document.getElementById("ticketStep").classList.add("active");
  } else {
    document.getElementById("tablesStep").classList.add("active");
  }

  document.getElementById("paymentStep").classList.add("active");
  document.getElementById("formStep").classList.add("active");
}

/* TICKET PRICE */
function updateTicketPrice(){
  ticketQty = Number(ticketQtyEl.value);
  document.getElementById("ticketTotal").textContent =
    (ticketQty * TICKET_PRICE).toLocaleString()+" TZS";
}
const ticketQtyEl=document.getElementById("ticketQty");

/* TABLES */
fetch(SCRIPT_URL)
  .then(r=>r.json())
  .then(d=>{
    availability = d.bookings || [];
    renderTables();
  });

function renderTables(){
  const tiers=[
    {id:"700K",price:700000,features:["Reserved VIP","Group Entry","Standard Service"]},
    {id:"1.2M",price:1200000,features:["Prime View","Fast Service","Priority Seating"]},
    {id:"1.8M",price:1800000,features:["Best View","Top Service","Elite Experience"]}
  ];
  const container=document.getElementById("packages");
  tiers.forEach(t=>{
    const used=availability.filter(b=>b.tier===t.id && b.status==="CONFIRMED").length;
    const div=document.createElement("div");
    div.className="package"+(used>=4?" sold":"");
    div.onclick=()=>tier=t.id;
    div.innerHTML=`<h3>${t.id}</h3><h1>${t.price.toLocaleString()}</h1>`+
      t.features.map(f=>`<p>âœ” ${f}</p>`).join("");
    container.appendChild(div);
  });
}

/* SUBMIT */
function submitBooking(){
  let amount=0, desc="";

  if(bookingType==="TICKET"){
    amount=ticketQty*TICKET_PRICE;
    desc=`${ticketQty} Ticket(s)`;
  } else {
    if(!tier) return alert("Select a VIP table");
    amount = tier==="700K"?700000:tier==="1.2M"?1200000:1800000;
    desc = `VIP Table ${tier}`;
  }

  const data={
    bookingType,
    tier,
    description:desc,
    quantity:ticketQty,
    amount,
    name:fullName.value,
    phone:phone.value,
    email:email.value,
    transactionCode:txn.value
  };

  fetch(SCRIPT_URL,{
    method:"POST",
    body:JSON.stringify({action:"addBooking",data})
  });

  window.open(
    `https://wa.me/${BYZ_WHATSAPP}?text=${encodeURIComponent(
      `NEW BYZ BOOKING\nName:${data.name}\n${desc}\nAmount:${amount}\nTxn:${data.transactionCode}`
    )}`,
    "_blank"
  );

  alert("Booking submitted. Please press SEND on WhatsApp.");
}
</script>

</body>
</html>
