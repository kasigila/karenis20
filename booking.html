<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>BYZ Booking</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

<style>
/* ===== RESPONSIVE SAFETY NET (keep) ===== */
html, body { max-width: 100%; overflow-x: hidden; }
* { box-sizing: border-box; }
img, svg { max-width: 100%; height: auto; }
h1 { font-size: clamp(1.6rem, 6vw, 2.6rem); line-height: 1.15; text-align: center; }
h2 { font-size: clamp(1.2rem, 5vw, 1.9rem); }
h3 { font-size: clamp(1.05rem, 4.5vw, 1.5rem); }
button { max-width: 100%; white-space: normal; }

@media (max-width: 768px) {
  .choice-grid, .packages { grid-template-columns: 1fr !important; }
  .card, .choice, .package, .selector, .payment { padding: 20px !important; }
}

@media (max-width: 600px) {
  .theme-toggle { top: 10px; right: 10px; transform: scale(0.92); }
}

/* ===== BYZ APPLE-STYLE TOKENS ===== */
:root{
  --bg:#07080c;
  --bg2:#0b0c12;
  --card: color-mix(in srgb, #11131d 82%, transparent);
  --card2: color-mix(in srgb, #0f1016 70%, transparent);
  --text:#ffffff;
  --muted: rgba(255,255,255,.68);
  --border: rgba(255,255,255,.12);
  --shadow: 0 24px 80px rgba(0,0,0,.55);
  --shadow-soft: 0 12px 40px rgba(0,0,0,.35);
  --radius-lg: 28px;
  --radius: 20px;
  --ease: cubic-bezier(.2,.8,.2,1);
  --accent:#7c4dff;
  --accent2:#ff3df2;
}

.light{
  --bg:#f5f6f8;
  --bg2:#eceef3;
  --card: rgba(255,255,255,.75);
  --card2: rgba(255,255,255,.9);
  --text:#0b0b12;
  --muted: rgba(11,11,18,.62);
  --border: rgba(11,11,18,.10);
  --shadow: 0 18px 60px rgba(0,0,0,.12);
  --shadow-soft: 0 10px 34px rgba(0,0,0,.10);
}

body{
  margin:0;
  color:var(--text);
  font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  background:
    radial-gradient(1200px 600px at 10% 0%, rgba(124,77,255,.22), transparent 60%),
    radial-gradient(1000px 700px at 90% 10%, rgba(255,61,242,.16), transparent 60%),
    linear-gradient(180deg, var(--bg), var(--bg2));
  transition:.3s;
}

a{color:inherit;text-decoration:none}

/* ===== Sticky header to match index aesthetic ===== */
.topnav{
  position:sticky;
  top:0;
  z-index:50;
  padding:14px 0;
  backdrop-filter: blur(14px);
  background: color-mix(in srgb, var(--bg) 72%, transparent);
  border-bottom:1px solid var(--border);
}
.topnav-inner{
  max-width:1100px;
  margin:auto;
  padding:0 18px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
}
.brand{
  display:flex;
  align-items:center;
  gap:10px;
  font-weight:800;
  letter-spacing:-.4px;
}
.brand img{ width:34px;height:34px;object-fit:contain; border-radius:10px; display:block; }
.pills{ display:flex; gap:10px; flex-wrap:wrap; }
.pill{
  display:inline-flex; align-items:center; gap:10px;
  padding:10px 14px;
  border-radius:999px;
  border:1px solid var(--border);
  background: color-mix(in srgb, var(--card2) 70%, transparent);
  box-shadow: var(--shadow-soft);
  transition: transform .2s var(--ease);
  font-weight:800;
  font-size:13px;
}
.pill:hover{ transform: translateY(-2px); }
.pill.primary{
  border-color: transparent;
  background: linear-gradient(135deg,var(--accent),var(--accent2));
  color:#fff;
}

/* THEME TOGGLE */
.theme-toggle{
  position:fixed;
  top:18px;
  right:18px;
  background: color-mix(in srgb, var(--card2) 70%, transparent);
  border:1px solid var(--border);
  border-radius:999px;
  padding:12px 14px;
  cursor:pointer;
  box-shadow: var(--shadow-soft);
  z-index: 80;
}

/* Page container */
.container{
  max-width:1100px;
  margin:auto;
  padding:26px 18px 90px;
}

.subtitle{
  text-align:center;
  color:var(--muted);
  margin: 10px 0 20px;
  font-size: 14px;
}

/* Steps */
.step{
  opacity:0;
  transform:translateY(26px);
  transition:.6s var(--ease);
  margin:0;
  padding:0;
}
.step.active{
  opacity:1;
  transform:none;
}

/* Cards / blocks */
.block{
  border:1px solid var(--border);
  background: var(--card);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-soft);
  padding: 26px;
}

/* CHOICE */
.choice-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
  gap:16px;
}
.choice{
  background: var(--card);
  border:1px solid var(--border);
  border-radius: var(--radius-lg);
  padding:28px;
  text-align:center;
  cursor:pointer;
  transition: transform .25s var(--ease), box-shadow .25s var(--ease), border-color .25s var(--ease);
  box-shadow: var(--shadow-soft);
}
.choice:hover{ transform: translateY(-4px); }
.choice.active{
  border-color: color-mix(in srgb, var(--accent2) 65%, var(--border) 35%);
  box-shadow: 0 28px 90px rgba(255,61,242,.22);
}
.choice i{ font-size: 2.4rem; color: var(--accent2); margin-bottom: 10px; }

/* Selector */
.selector{
  max-width:520px;
  margin:18px auto 0;
  background: var(--card);
  border:1px solid var(--border);
  border-radius: var(--radius-lg);
  padding: 22px;
  box-shadow: var(--shadow-soft);
  text-align:center;
}
.selector select{
  width:100%;
  padding:14px;
  border-radius:14px;
  border:1px solid var(--border);
  background: color-mix(in srgb, var(--card2) 80%, transparent);
  color:var(--text);
  font-size:1rem;
  outline:none;
}
.selector select:focus{
  border-color: color-mix(in srgb, var(--accent) 60%, var(--border) 40%);
  box-shadow: 0 0 0 6px rgba(124,77,255,.12);
}

.price-display{
  margin-top:14px;
  font-size:1.4rem;
  font-weight:900;
  color: var(--accent2);
}

/* VIP packages */
.packages{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
  gap:16px;
  margin-top: 10px;
}
.package{
  position:relative;
  background: var(--card);
  border:1px solid var(--border);
  border-radius: var(--radius-lg);
  padding: 22px;
  transition: transform .25s var(--ease), box-shadow .25s var(--ease), border-color .25s var(--ease);
  cursor:pointer;
  box-shadow: var(--shadow-soft);
}
.package:hover{ transform: translateY(-4px); }
.package.active{
  border-color: color-mix(in srgb, var(--accent2) 65%, var(--border) 35%);
  box-shadow: 0 28px 90px rgba(255,61,242,.22);
}
.package h1{ margin: 10px 0 10px; text-align:left; }
.package h3{ margin:0; }
.package p{ margin: 8px 0 0; color: var(--muted); font-size: 13px; }

.sold{ pointer-events:none; opacity:.35; }
.sold::after{
  content:"SOLD OUT";
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  background:rgba(0,0,0,.65);
  border-radius: var(--radius-lg);
  font-size:1.2rem;
  font-weight:900;
}

/* Payment */
.payment{
  border:1px solid var(--border);
  background: var(--card);
  border-radius: var(--radius-lg);
  padding: 22px;
  box-shadow: var(--shadow-soft);
  text-align:center;
}
.kv{
  margin: 14px auto 0;
  max-width: 520px;
  border:1px solid var(--border);
  background: color-mix(in srgb, var(--card2) 70%, transparent);
  border-radius: 22px;
  padding: 18px;
}
.kv .label{ color: var(--muted); font-size: 12px; margin: 0 0 6px; }
.kv .value{ margin: 0; font-weight: 900; letter-spacing: .14em; }

.btn{
  width:100%;
  padding:16px;
  border:none;
  border-radius:999px;
  background: linear-gradient(135deg,var(--accent),var(--accent2));
  color:#fff;
  font-weight:900;
  cursor:pointer;
  transition: transform .2s var(--ease);
}
.btn:hover{ transform: translateY(-2px); }

.form{ max-width:560px; margin: 0 auto; }
input{
  width:100%;
  padding:14px;
  border-radius:14px;
  border:1px solid var(--border);
  background: color-mix(in srgb, var(--card2) 80%, transparent);
  color:var(--text);
  margin:10px 0;
  outline:none;
}
input:focus{
  border-color: color-mix(in srgb, var(--accent) 60%, var(--border) 40%);
  box-shadow: 0 0 0 6px rgba(124,77,255,.12);
}

.notice{
  text-align:center;
  color:#ffcc00;
  font-weight:800;
  margin-top:14px;
  font-size: 13px;
}
</style>
</head>

<body>

<div class="topnav">
  <div class="topnav-inner">
    <a class="brand" href="index.html" aria-label="BYZ home">
      <img src="assets/BYZ%20W.PNG" alt="BYZ logo">
      <span>Booking</span>
    </a>
    <div class="pills">
      <a class="pill" href="index.html"><i class="fa-solid fa-house"></i> Home</a>
      <a class="pill primary" href="https://kasigila.github.io/byzmock/admin.html"><i class="fa-solid fa-lock"></i> Admin</a>
    </div>
  </div>
</div>

<div class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle theme">
  <i class="fa-solid fa-circle-half-stroke"></i>
</div>

<div class="container">

  <h1>Reserve Your Night with BYZ</h1>
  <p class="subtitle">Choose your experience</p>

  <!-- STEP 1 -->
  <div class="step active" id="step1">
    <div class="choice-grid">
      <div class="choice" onclick="selectType('TICKET',this)">
        <i class="fa-solid fa-ticket"></i>
        <h2>Tickets</h2>
        <p class="subtitle">30,000 TZS per ticket</p>
      </div>
      <div class="choice" onclick="selectType('TABLE',this)">
        <i class="fa-solid fa-couch"></i>
        <h2>VIP Tables</h2>
        <p class="subtitle">Premium experience</p>
      </div>
    </div>
  </div>

  <!-- TICKET SELECTOR -->
  <div class="step" id="ticketStep">
    <div class="selector">
      <h2>Select Number of Tickets</h2>
      <select id="ticketQty" onchange="updateTicketPrice()">
        <option value="1">1 Ticket</option>
        <option value="2">2 Tickets</option>
        <option value="3">3 Tickets</option>
        <option value="4">4 Tickets</option>
        <option value="5">5 Tickets</option>
        <option value="6">6 Tickets</option>
        <option value="7">7 Tickets</option>
        <option value="8">8 Tickets</option>
        <option value="9">9 Tickets</option>
        <option value="10">10 Tickets</option>
      </select>
      <div class="price-display" id="ticketTotal">30,000 TZS</div>
    </div>
  </div>

  <!-- TABLES -->
  <div class="step" id="tablesStep">
    <p class="subtitle">Choose your VIP package</p>
    <div class="packages" id="packages"></div>
  </div>

  <!-- PAYMENT -->
  <div class="step" id="paymentStep">
    <div class="payment">
      <h2>Pay via M-Pesa</h2>
      <p class="subtitle">Complete payment before submitting your booking</p>

      <div class="kv">
        <p class="label">Business Name</p>
        <h3 style="margin:0 0 12px;">BYZ Entertainment</h3>

        <p class="label">M-Pesa Lipa Number</p>
        <h1 id="mpesaNumber" class="value" style="text-align:center;">68286833</h1>

        <div style="max-width:420px;margin:14px auto 0;">
          <button class="btn" type="button" onclick="copyMpesa()">ðŸ“‹ Copy Lipa Number</button>
        </div>

        <p style="font-size:.85rem;color:var(--muted);margin:12px 0 0;">
          Once payment is completed copy-paste the Transaction ID into this form.
        </p>
      </div>
    </div>
  </div>

  <!-- FORM -->
  <div class="step" id="formStep">
    <div class="form">
      <input id="fullName" placeholder="Full Name">
      <input id="phone" placeholder="Phone (WhatsApp)">
      <input id="email" placeholder="Email">
      <input id="txn" placeholder="M-Pesa Transaction Code">
      <button class="btn" onclick="submitBooking()">Submit Booking</button>
      <div class="notice">WhatsApp will open â€” press SEND to verify payment</div>
    </div>
  </div>

</div>

<script>
function copyMpesa(){
  const number = document.getElementById("mpesaNumber").innerText;

  if (navigator.clipboard) {
    navigator.clipboard.writeText(number);
  } else {
    const temp = document.createElement("textarea");
    temp.value = number;
    document.body.appendChild(temp);
    temp.select();
    document.execCommand("copy");
    document.body.removeChild(temp);
  }

  alert("Lipa number copied. Open M-Pesa to complete payment.");
}

const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxl8qg5fxw8yWZJj-R98x0V0nBALjQv66xuJLiom5rkEh_BpYtZRrMcFlYkjxAOq6UC/exec";
const BYZ_WHATSAPP = "255768464367";
const TICKET_PRICE = 30000;

let bookingType="", tier="", ticketQty=1, availability={};

/* THEME */
function toggleTheme(){
  document.body.classList.toggle("light");
}

/* TYPE SELECT */
function selectType(type,el){
  bookingType=type;
  document.querySelectorAll(".choice").forEach(c=>c.classList.remove("active"));
  el.classList.add("active");

  document.getElementById("ticketStep").classList.remove("active");
  document.getElementById("tablesStep").classList.remove("active");

  if(type==="TICKET"){
    document.getElementById("ticketStep").classList.add("active");
  } else {
    document.getElementById("tablesStep").classList.add("active");
  }

  document.getElementById("paymentStep").classList.add("active");
  document.getElementById("formStep").classList.add("active");
}

/* TICKET PRICE */
function updateTicketPrice(){
  ticketQty = Number(ticketQtyEl.value);
  document.getElementById("ticketTotal").textContent =
    (ticketQty * TICKET_PRICE).toLocaleString()+" TZS";
}
const ticketQtyEl=document.getElementById("ticketQty");

/* TABLES */
fetch(SCRIPT_URL)
  .then(r=>r.json())
  .then(d=>{
    availability = d.bookings || [];
    renderTables();
  });

function renderTables(){
  const tiers=[
    {id:"700K",price:700000,features:["Reserved VIP","Group Entry","Standard Service"]},
    {id:"1.2M",price:1200000,features:["Prime View","Fast Service","Priority Seating"]},
    {id:"1.8M",price:1800000,features:["Best View","Top Service","Elite Experience"]}
  ];
  const container=document.getElementById("packages");
  tiers.forEach(t=>{
    const used=availability.filter(b=>b.tier===t.id && b.status==="CONFIRMED").length;
    const div=document.createElement("div");
    div.className="package"+(used>=4?" sold":"");
    div.onclick=()=>tier=t.id;
    div.innerHTML=`<h3>${t.id}</h3><h1>${t.price.toLocaleString()}</h1>`+
      t.features.map(f=>`<p>âœ” ${f}</p>`).join("");
    container.appendChild(div);
  });
}

/* SUBMIT */
function submitBooking(){
  let amount=0, desc="";

  if(bookingType==="TICKET"){
    amount=ticketQty*TICKET_PRICE;
    desc=`${ticketQty} Ticket(s)`;
  } else {
    if(!tier) return alert("Select a VIP table");
    amount = tier==="700K"?700000:tier==="1.2M"?1200000:1800000;
    desc = `VIP Table ${tier}`;
  }

  const data={
    bookingType,
    tier,
    description:desc,
    quantity:ticketQty,
    amount,
    name:fullName.value,
    phone:phone.value,
    email:email.value,
    transactionCode:txn.value
  };

  fetch(SCRIPT_URL,{
    method:"POST",
    body:JSON.stringify({action:"addBooking",data})
  });

  window.open(
    `https://wa.me/${BYZ_WHATSAPP}?text=${encodeURIComponent(
      `NEW BYZ BOOKING\nName:${data.name}\n${desc}\nAmount:${amount}\nTxn:${data.transactionCode}`
    )}`,
    "_blank"
  );

  alert("Booking submitted. Please press SEND on WhatsApp.");
}
</script>

</body>
</html>
