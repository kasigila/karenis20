<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>BYZ Booking</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
body{background:#0b0b12;color:#fff;font-family:Inter;margin:0}
.container{max-width:540px;margin:auto;padding:40px}
.card{background:#151520;border-radius:20px;padding:24px;margin-bottom:22px}
h1{text-align:center}
button{width:100%;padding:16px;border:none;border-radius:999px;
background:linear-gradient(135deg,#8A2BE2,#FF00FF);color:white;font-weight:700}
button:disabled{opacity:.4}
.table{padding:12px;border-radius:12px;background:#1e1e2c;margin:6px 0;cursor:pointer}
.table.sold{opacity:.3;pointer-events:none}
.notice{color:#ffcc00;text-align:center;font-weight:600}
</style>
</head>

<body>
<div class="container">
<h1>BYZ Booking</h1>

<div id="cutoff" class="notice" style="display:none">
Bookings after 11PM are closed.
<br><br>
<a href="tel:+255768464367"><button>Call BYZ</button></a>
</div>

<div class="card">
<select id="type" onchange="toggle()">
<option value="">Select Booking Type</option>
<option value="TICKET">Individual Ticket â€“ 30,000</option>
<option value="TABLE">VIP Table</option>
</select>

<div id="tickets" style="display:none">
<input id="qty" type="number" min="1" value="1" placeholder="Ticket Quantity">
</div>

<div id="tables" style="display:none">
<h4>VIP Tables</h4>
<div id="tableList"></div>
</div>
</div>

<div class="card">
<input id="fullName" placeholder="Full Name">
<input id="phone" placeholder="Phone (WhatsApp)">
<input id="email" placeholder="Email">
<input id="txn" placeholder="M-Pesa Transaction Code">
</div>

<button id="submit" onclick="submit()">Submit Booking</button>
</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxl8qg5fxw8yWZJj-R98x0V0nBALjQv66xuJLiom5rkEh_BpYtZRrMcFlYkjxAOq6UC/exec";

if (new Date().getHours() >= 23) {
  cutoff.style.display="block";
  submit.disabled=true;
}

let availability={};

fetch(SCRIPT_URL).then(r=>r.json()).then(d=>{
  availability=d.availability;
  renderTables();
});

function toggle(){
  tickets.style.display = type.value==="TICKET"?"block":"none";
  tables.style.display = type.value==="TABLE"?"block":"none";
}

function renderTables(){
  tableList.innerHTML="";
  ["700K","1.2M","1.8M"].forEach(tier=>{
    for(let i=1;i<=4;i++){
      const num = i;
      const div=document.createElement("div");
      div.className="table";
      div.textContent=`${tier} Table ${num}`;
      if (availability[tier]?.includes(num)) div.classList.add("sold");
      div.onclick=()=>selectTable(tier,num);
      tableList.appendChild(div);
    }
  });
}

let selected={};

function selectTable(tier,num){
  selected={tier,tableNumber:num};
  alert(`Selected ${tier} Table ${num}`);
}

function submit(){
  let data={};

  if(type.value==="TICKET"){
    data={
      bookingType:"TICKET",
      description:`${qty.value} Individual Ticket(s)`,
      quantity:qty.value,
      amount:qty.value*30000
    };
  }else{
    data={
      bookingType:"TABLE",
      tier:selected.tier,
      tableNumber:selected.tableNumber,
      description:`VIP Table ${selected.tier}`,
      amount: selected.tier==="700K"?700000:selected.tier==="1.2M"?1200000:1800000
    };
  }

  data.name = document.getElementById("fullName").value;
  data.phone = document.getElementById("phone").value;
data.email = document.getElementById("email").value;
data.transactionCode = document.getElementById("txn").value;

  fetch(SCRIPT_URL,{
    method:"POST",
    body:JSON.stringify({action:"addBooking",data})
  });

  window.open(
    `https://wa.me/255768464367?text=${encodeURIComponent(
      `NEW BYZ BOOKING\n${data.description}\nName:${data.name}\nTxn:${data.transactionCode}`
    )}`
  );

  alert("Booking submitted. Pending verification.");
}
</script>
</body>
</html>
