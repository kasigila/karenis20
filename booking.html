<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>BYZ Booking</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
body{
  background:#0b0b12;
  color:#fff;
  font-family:Inter,system-ui;
  margin:0;
}

.container{
  max-width:540px;
  margin:auto;
  padding:40px 20px;
}

.card{
  background:#151520;
  border-radius:20px;
  padding:24px;
  margin-bottom:22px;
}

h1{text-align:center;margin-bottom:6px}
p{text-align:center;color:#aaa}

input, select{
  width:100%;
  padding:14px;
  margin-top:10px;
  border:none;
  border-radius:12px;
  background:#1e1e2c;
  color:#fff;
}

button{
  width:100%;
  padding:16px;
  border:none;
  border-radius:999px;
  background:linear-gradient(135deg,#8A2BE2,#FF00FF);
  color:white;
  font-weight:700;
  cursor:pointer;
}

button:disabled{
  opacity:.4;
  cursor:not-allowed;
}

.notice{
  text-align:center;
  font-weight:600;
  color:#ffcc00;
  margin-bottom:18px;
}

.amount-box{
  background:#1e1e2c;
  border-radius:14px;
  padding:16px;
  text-align:center;
  font-weight:700;
  margin-top:10px;
}
</style>
</head>

<body>
<div class="container">

<h1>BYZ Booking</h1>
<p>Reserve your spot</p>

<div id="cutoffNotice" class="notice" style="display:none">
Online bookings close at 11:00 PM.  
<br><br>
<a href="tel:+255768464367">
  <button>Call BYZ</button>
</a>
</div>

<div class="card">
<label>Booking Type</label>
<select id="bookingType" onchange="toggleBookingType()">
  <option value="">Select</option>
  <option value="TICKET">Individual Ticket (30,000 each)</option>
  <option value="TABLE">VIP Table</option>
</select>

<div id="ticketSection" style="display:none">
  <label>Number of Tickets</label>
  <input type="number" id="ticketQty" min="1" value="1" onchange="updateTicketAmount()">
  <div class="amount-box">
    Total: <span id="ticketTotal">30,000</span> TZS
  </div>
</div>

<div id="tableSection" style="display:none">
  <label>Table Package</label>
  <select id="tablePackage">
    <option value="">Select Package</option>
    <option value="700K">Tier 1 – 700,000 (Entry VIP)</option>
    <option value="1.2M">Tier 2 – 1,200,000 (Mid VIP)</option>
    <option value="1.8M">Tier 3 – 1,800,000 (Premium VIP)</option>
  </select>
</div>
</div>

<div class="card">
<label>Full Name</label>
<input id="fullName" placeholder="Your name">

<label>Phone (WhatsApp)</label>
<input id="phone" placeholder="07XXXXXXXX">

<label>Email</label>
<input id="email" placeholder="you@email.com">

<label>M-Pesa Transaction Code</label>
<input id="txn" placeholder="e.g. QH34KLM">
</div>

<div class="notice">
After submitting, you will be taken to WhatsApp.  
<br>
<b>Please press SEND</b> to start payment verification.
</div>

<button id="submitBtn" onclick="submitBooking()">Submit Booking</button>

</div>

<script>
const SCRIPT_URL = "PASTE_YOUR_CURRENT_APPS_SCRIPT_URL_HERE";
const BYZ_WHATSAPP = "255768464367";
const TICKET_PRICE = 30000;

/* 11PM CUTOFF */
(function(){
  const now = new Date();
  if (now.getHours() >= 23) {
    document.getElementById("cutoffNotice").style.display = "block";
    document.getElementById("submitBtn").disabled = true;
  }
})();

function toggleBookingType(){
  document.getElementById("ticketSection").style.display =
    bookingType.value === "TICKET" ? "block" : "none";
  document.getElementById("tableSection").style.display =
    bookingType.value === "TABLE" ? "block" : "none";

  if (bookingType.value === "TICKET") {
    updateTicketAmount();
  }
}

function updateTicketAmount(){
  const qty = Number(document.getElementById("ticketQty").value || 1);
  const total = qty * TICKET_PRICE;
  document.getElementById("ticketTotal").textContent =
    total.toLocaleString();
}

function submitBooking(){
  const type = bookingType.value;
  if (!type) return alert("Please select a booking type.");

  let data = {};
  let messageDescription = "";

  if (type === "TICKET") {
    const qty = Number(document.getElementById("ticketQty").value);
    const total = qty * TICKET_PRICE;

    data = {
      bookingType: "TICKET",
      quantity: qty,
      description: `${qty} Individual Ticket(s)`,
      amount: total
    };

    messageDescription = `${qty} Ticket(s) – ${total.toLocaleString()} TZS`;
  } else {
    const pkg = document.getElementById("tablePackage").value;
    if (!pkg) return alert("Please select a table package.");

    let amount = pkg === "700K" ? 700000 :
                 pkg === "1.2M" ? 1200000 : 1800000;

    data = {
      bookingType: "TABLE",
      tier: pkg,
      description: `VIP Table – ${pkg}`,
      amount: amount
    };

    messageDescription = `VIP Table ${pkg} – ${amount.toLocaleString()} TZS`;
  }

  data.name = document.getElementById("fullName").value;
  data.phone = document.getElementById("phone").value;
  data.email = document.getElementById("email").value;
  data.transactionCode = document.getElementById("txn").value;

  fetch(SCRIPT_URL, {
    method: "POST",
    body: JSON.stringify({ action: "addBooking", data })
  });

  const whatsappMessage =
`NEW BYZ BOOKING (PENDING)
Name: ${data.name}
Phone: ${data.phone}
Booking: ${messageDescription}
Txn Code: ${data.transactionCode}

Please verify payment and approve.`;

  window.open(
    `https://wa.me/${BYZ_WHATSAPP}?text=${encodeURIComponent(whatsappMessage)}`,
    "_blank"
  );

  alert(
    "Booking submitted.\n\nIMPORTANT:\nPlease press SEND on WhatsApp so BYZ can verify your payment."
  );
}
</script>

</body>
</html>
