<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>BYZ Admin Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

<style>
:root{
  --bg:#07080c;
  --bg2:#0b0c12;
  --card: color-mix(in srgb, #11131d 82%, transparent);
  --card2: color-mix(in srgb, #0f1016 70%, transparent);
  --text:#ffffff;
  --sub: rgba(255,255,255,.68);
  --border: rgba(255,255,255,.12);
  --shadow: 0 24px 80px rgba(0,0,0,.55);
  --shadow-soft: 0 12px 40px rgba(0,0,0,.35);
  --radius-lg: 24px;
  --radius: 18px;
  --ease: cubic-bezier(.2,.8,.2,1);
  --accent: #7c4dff;
  --accent2:#ff3df2;
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  background:
    radial-gradient(1200px 600px at 10% 0%, rgba(124,77,255,.22), transparent 60%),
    radial-gradient(1000px 700px at 90% 10%, rgba(255,61,242,.16), transparent 60%),
    linear-gradient(180deg, var(--bg), var(--bg2));
  color:var(--text);
}

a{color:inherit;text-decoration:none}

.container{
  max-width:1200px;
  margin:auto;
  padding:24px 18px 60px;
}

.hidden{display:none}

/* Top nav */
.topnav{
  position:sticky;
  top:0;
  z-index:50;
  padding:14px 0;
  backdrop-filter: blur(14px);
  background: color-mix(in srgb, var(--bg) 72%, transparent);
  border-bottom:1px solid var(--border);
}
.topnav-inner{
  max-width:1200px;
  margin:auto;
  padding:0 18px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:14px;
}
.brand{
  display:flex;
  align-items:center;
  gap:10px;
  font-weight:800;
  letter-spacing:-.4px;
}
.brand img{
  width:34px;height:34px;object-fit:contain;
  border-radius:10px;
  display:block;
}
.nav-actions{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}
.pill{
  display:inline-flex;
  align-items:center;
  gap:10px;
  padding:10px 14px;
  border-radius:999px;
  border:1px solid var(--border);
  background: color-mix(in srgb, var(--card2) 70%, transparent);
  box-shadow: var(--shadow-soft);
  transition: transform .2s var(--ease);
  font-weight:700;
  font-size:13px;
}
.pill:hover{transform: translateY(-2px)}
.pill.primary{
  border-color: transparent;
  background: linear-gradient(135deg, var(--accent), var(--accent2));
}

/* Login */
.login-wrap{
  max-width:420px;
  margin: 70px auto 0;
}
.login-box{
  background: var(--card);
  border:1px solid var(--border);
  border-radius: 26px;
  padding: 26px;
  box-shadow: var(--shadow);
}
.login-box h1{
  margin:0;
  font-size: 24px;
  letter-spacing:-.6px;
}
.login-box p{
  margin:8px 0 0;
  color: var(--sub);
  font-size: 13px;
}
.input{
  width:100%;
  padding:14px 14px;
  margin-top:14px;
  border-radius:14px;
  border:1px solid var(--border);
  background: color-mix(in srgb, #0b0b12 70%, transparent);
  color: var(--text);
  outline:none;
}
.input:focus{
  border-color: color-mix(in srgb, var(--accent) 60%, var(--border) 40%);
  box-shadow: 0 0 0 6px rgba(124,77,255,.15);
}
.btn{
  width:100%;
  padding:14px;
  margin-top:14px;
  border:none;
  border-radius:999px;
  background: linear-gradient(135deg, var(--accent), var(--accent2));
  color:white;
  font-weight:800;
  cursor:pointer;
  transition: transform .2s var(--ease);
}
.btn:hover{transform: translateY(-2px)}

/* Dashboard header */
.dash-head{
  margin-top: 18px;
  padding: 16px 18px;
  border:1px solid var(--border);
  border-radius: 22px;
  background: var(--card);
  box-shadow: var(--shadow-soft);
}
.dash-head h1{
  margin:0;
  font-size: 22px;
  letter-spacing:-.5px;
}
.dash-head p{
  margin:6px 0 0;
  color: var(--sub);
  font-size: 13px;
}

/* Filters row */
.top-bar{
  margin-top:14px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:12px;
  flex-wrap:wrap;
}
.filters{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}
.filters input, .filters select{
  padding:11px 12px;
  border-radius:14px;
  background: color-mix(in srgb, var(--card2) 70%, transparent);
  color: var(--text);
  border:1px solid var(--border);
  outline:none;
  min-width: 220px;
}
.filters input:focus, .filters select:focus{
  border-color: color-mix(in srgb, var(--accent) 60%, var(--border) 40%);
  box-shadow: 0 0 0 6px rgba(124,77,255,.12);
}
.refresh{
  padding:11px 14px;
  border-radius:999px;
  border:1px solid var(--border);
  background: color-mix(in srgb, var(--card2) 70%, transparent);
  color:var(--text);
  font-weight:800;
  cursor:pointer;
  transition: transform .2s var(--ease);
}
.refresh:hover{transform: translateY(-2px)}

/* Table card */
.table-card{
  margin-top:14px;
  border:1px solid var(--border);
  border-radius: 22px;
  background: var(--card);
  box-shadow: var(--shadow-soft);
  overflow:hidden;
}
table{
  width:100%;
  border-collapse:collapse;
}
th,td{
  padding:14px 12px;
  border-bottom:1px solid rgba(255,255,255,.08);
  text-align:left;
  vertical-align:top;
  font-size: 13px;
}
th{
  color: rgba(255,255,255,.55);
  font-size: 12px;
  font-weight:800;
  letter-spacing:.02em;
}
tbody tr:hover{
  background: rgba(255,255,255,.03);
}

.status{font-weight:900}
.PENDING{color:#ffd24a}
.CONFIRMED{color:#25D366}

/* Approve button */
.approve{
  background:#25D366;
  padding:8px 14px;
  border-radius:999px;
  border:none;
  color:#08120b;
  font-weight:900;
  cursor:pointer;
  transition: transform .2s var(--ease);
}
.approve:hover{transform: translateY(-2px)}
.approve:disabled{
  opacity:.4;
  cursor:not-allowed;
  transform:none;
}

/* Mobile tweaks */
@media (max-width: 800px){
  th:nth-child(3), td:nth-child(3){display:none} /* hide Description on small screens */
}
</style>
</head>

<body>

<div class="topnav">
  <div class="topnav-inner">
    <a class="brand" href="index.html" aria-label="Back to BYZ home">
      <img src="assets/BYZ%20W.PNG" alt="BYZ logo">
      <span>BYZ Admin</span>
    </a>
    <div class="nav-actions">
      <a class="pill" href="index.html"><i class="fa-solid fa-arrow-left"></i> Back</a>
      <a class="pill primary" href="https://kasigila.github.io/byzmock/booking.html"><i class="fa-solid fa-ticket"></i> Booking Page</a>
    </div>
  </div>
</div>

<!-- LOGIN -->
<div class="login-wrap" id="login">
  <div class="login-box">
    <h1>Secure access</h1>
    <p>Enter admin password to view live bookings & approvals.</p>
    <input class="input" id="password" type="password" placeholder="Admin password">
    <button class="btn" onclick="login()">Enter</button>
  </div>
</div>

<!-- DASHBOARD -->
<div id="dashboard" class="container hidden">
  <div class="dash-head">
    <h1>BYZ Admin Dashboard</h1>
    <p>Live bookings & approvals</p>
  </div>

  <div class="top-bar">
    <div class="filters">
      <input id="search" placeholder="Search name / booking ID" oninput="render()">
      <select id="statusFilter" onchange="render()">
        <option value="">All</option>
        <option value="PENDING">Pending</option>
        <option value="CONFIRMED">Confirmed</option>
      </select>
    </div>
    <button class="refresh" onclick="load()">Refresh</button>
  </div>

  <div class="table-card">
    <table>
      <thead>
        <tr>
          <th>Booking ID</th>
          <th>Type</th>
          <th>Description</th>
          <th>Name</th>
          <th>Phone</th>
          <th>Amount</th>
          <th>Status</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="rows"></tbody>
    </table>
  </div>
</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxl8qg5fxw8yWZJj-R98x0V0nBALjQv66xuJLiom5rkEh_BpYtZRrMcFlYkjxAOq6UC/exec";
const ADMIN_PASSWORD = "weballwithbyz";

let bookings = [];

/* LOGIN */
function login(){
  if(password.value === ADMIN_PASSWORD){
    document.getElementById("login").classList.add("hidden");
    document.getElementById("dashboard").classList.remove("hidden");
    load();
  } else {
    alert("Incorrect password");
  }
}

/* LOAD DATA */
function load() {
  fetch(SCRIPT_URL)
    .then(res => res.json())
    .then(data => {
      console.log("ADMIN RAW RESPONSE:", data);

      if (!data.bookings || !Array.isArray(data.bookings)) {
        alert("No bookings returned from server");
        return;
      }

      bookings = data.bookings;
      render();
    })
    .catch(err => {
      console.error("ADMIN FETCH ERROR:", err);
      alert("Failed to load bookings");
    });
}

/* RENDER TABLE */
function render(){
  const q = search.value.toLowerCase();
  const status = statusFilter.value;
  rows.innerHTML="";

  bookings
    .filter(b =>
      (!status || b.status === status) &&
      (!q ||
        (b.name||"").toLowerCase().includes(q) ||
        (b.bookingId||"").toLowerCase().includes(q)
      )
    )
    .forEach(b=>{
      const tr=document.createElement("tr");

      tr.innerHTML=`
        <td>${b.bookingId}</td>
        <td>${b.bookingType}</td>
        <td>${b.description}</td>
        <td>${b.name}</td>
        <td>${b.phone}</td>
        <td>${b.amount}</td>
        <td class="status ${b.status}">${b.status}</td>
        <td>
          ${b.status==="PENDING"
            ? `<button class="approve" onclick="approve('${b.bookingId}')">Approve</button>`
            : "â€”"
          }
        </td>
      `;

      rows.appendChild(tr);
    });
}

/* APPROVE */
function approve(id){
  if(!confirm("Approve this payment?")) return;

  fetch(SCRIPT_URL,{
    method:"POST",
    body:JSON.stringify({action:"approvePayment",bookingId:id})
  }).then(()=>{
    alert("Approved & email sent");
    load();
  });
}
</script>

</body>
</html>
